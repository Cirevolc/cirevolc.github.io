<!DOCTYPE html>
<meta charset="utf-8">
<html lang="en">

<head>
    <title>A Visualization Demo of Crime Data in Boston</title>
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <style>
        .pg-h1 {
            font: 30px "Hiragino Sans GB", "STHeiti", "Microsoft YaHei", SimHei, "Helvetica Neue", Helvetica, Arial, sans-serif !important;
        }

        .pg-h2 {
            font: 20px "Hiragino Sans GB", "STHeiti", "Microsoft YaHei", SimHei, "Helvetica Neue", Helvetica, Arial, sans-serif !important;
        }

        .dd {

            font: 20px "Hiragino Sans GB", "STHeiti", "Microsoft YaHei", SimHei, "Helvetica Neue", Helvetica, Arial, sans-serif !important;
            width: 300px;
            height: 30px;
        }
    </style>
</head>

<body>
    <h1 align="center" class="pg-h1">
        Over the last 4 years, the average crime rate across Boston area is 0.072.
    </h1>
    <h2 align="center" class="pg-h2">
        Select a neighborhood in Boston:
    </h2>
    <div align="center"><select class="dd" id="neighborhood_select" onchange="dropDownCallBack()">
            <option value="Allston">Allston</option>
            <option value="Boston">Boston</option>
            <option value="Brighton">Brighton</option>
            <option value="Brookline">Brookline</option>
            <option value="Cambridge">Cambridge</option>
            <option value="Charlestown">Charlestown</option>
            <option value="Chelsea">Chelsea</option>
            <option value="Dedham">Dedham</option>
            <option value="Dorchester">Dorchester</option>
            <option value="Dorchester Center">Dorchester Center</option>
            <option value="Hyde Park">Hyde Park</option>
            <option value="Jamaica Plain">Jamaica Plain</option>
            <option value="Mattapan">Mattapan</option>
            <option value="Milton">Milton</option>
            <option value="Quincy">Quincy</option>
            <option value="Revere">Revere</option>
            <option value="Roslindale">Roslindale</option>
            <option value="Roxbury">Roxbury</option>
            <option value="Roxbury Crossing">Roxbury Crossing</option>
            <option value="Somerville">Somerville</option>
            <option value="West Roxbury">West Roxbury</option>
            <option value="Winthrop">Winthrop</option>
        </select></div>
    <h2 align="center" class="pg-h2" id="drop_down_display">
        Crime rate: <br> Average price of property:
    </h2>
    <svg width="960" height="720" id="svg1"></svg>
    <script>
        function dropDownCallBack() {
            var x = document.getElementById("neighborhood_select").value;
            var crime_rate;
            var avg_price;
            d3.csv("crime_rate_by_neighborhood.csv", function (data) {
                data.forEach(function (d) {
                    if (d.Neighborhood == x) {
                        crime_rate = d["Crime Rate By Neighborhood"];
                    }
                });
            });
            d3.csv("average_price_by_neighborhood.csv", function (data) {
                data.forEach(function (d) {
                    if (d.area == x) {
                        avg_price = d["average_price_per_square_feet"];
                    }
                });
            });
            document.getElementById("drop_down_display").innerHTML = "Crime rate: " + crime_rate + "<br>" + "Average price of property: " + avg_price;
        }

        function fillFirstMap(d){
            var color;
            d3.csv("crime_rate_by_neighborhood.csv", function (data) {
                data.forEach(function (row) {
                    if (row.Neighborhood == d.properties.NAME) {
                        if (row["Crime Rate By Neighborhood"] < 0.072){
                            color = "#d0f5f5";
                        }
                        else
                            color = "orange";
                    }
                });
            });
            return color;
        }

        d3.json("boston_neighborhoods.json", function (error, boston) {
            var svg = d3.select("#svg1"),
                width = +svg.attr("width"),
                height = +svg.attr("height");
            if (error) throw error;

            var path = d3.geoPath()
                .projection(d3.geoConicConformal()
                    .parallels([41 + 43 / 60, 42 + 41 / 60])
                    .rotate([71 + 30 / 60, 0])
                    .fitSize([width, height], boston));

            svg.selectAll("path")
                .data(boston.features)
                .enter().append("path")
                .attr("d", path)
                .style('fill', fillFirstMap);

        });
    </script>
</body>

</html>